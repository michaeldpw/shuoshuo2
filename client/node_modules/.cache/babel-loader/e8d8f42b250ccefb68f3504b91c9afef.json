{"ast":null,"code":"import _regeneratorRuntime from\"/Users/peiwendu/Desktop/shuoshuo2.0/client/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/peiwendu/Desktop/shuoshuo2.0/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Users/peiwendu/Desktop/shuoshuo2.0/client/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/peiwendu/Desktop/shuoshuo2.0/client/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/Users/peiwendu/Desktop/shuoshuo2.0/client/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/Users/peiwendu/Desktop/shuoshuo2.0/client/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _inherits from\"/Users/peiwendu/Desktop/shuoshuo2.0/client/node_modules/@babel/runtime/helpers/esm/inherits\";import React from'react';import axios from'axios';import'./components.css';import Img from'./Img';var PostList=/*#__PURE__*/function(_React$Component){_inherits(PostList,_React$Component);function PostList(){var _getPrototypeOf2;var _this;_classCallCheck(this,PostList);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_possibleConstructorReturn(this,(_getPrototypeOf2=_getPrototypeOf(PostList)).call.apply(_getPrototypeOf2,[this].concat(args)));_this.state={post:[],total:0,currentPage:1};_this.getCount=function(){axios.get('/count').then(function(res){_this.setState({total:res.data.count});});};_this.getData=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(page){var response,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return fetch(\"/allpost?page=\".concat(page),{method:'GET',headers:{'Accept':'application/json','Content-Type':'application/json'}});case 2:response=_context.sent;_context.next=5;return response.json();case 5:data=_context.sent;_this.setState({post:data.result,currentPage:data.page+1});case 7:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}();_this.handlePrevious=function(){if(_this.state.currentPage!==1){_this.getData(_this.state.currentPage-1-1);console.log(\"previous\");}};_this.handleNext=function(){var total_page=Math.ceil(_this.state.total/5);console.log(_this.state.currentPage+1);if(_this.state.currentPage<total_page){_this.getData(_this.state.currentPage);console.log(\"next\");}};return _this;}_createClass(PostList,[{key:\"componentDidMount\",value:function componentDidMount(){this.getCount();this.getData(0);//0是后端的第一页\n}},{key:\"render\",value:function render(){var _this2=this;var pageNumber=[];if(this.state.total!==0){for(var i=1;i<=Math.ceil(this.state.total/5);i++){pageNumber.push(i);}}return React.createElement(\"div\",{className:\"container\"},React.createElement(\"nav\",{\"aria-label\":\"Page navigation\"},React.createElement(\"ul\",{className:\"pagination\"},React.createElement(\"li\",{onClick:this.handlePrevious},React.createElement(\"a\",{\"aria-label\":\"Previous\"},React.createElement(\"span\",{\"aria-hidden\":\"true\"},\"\\xAB\"))),pageNumber.map(function(item,index){var classes=_this2.state.currentPage===item?\"active\":'';return React.createElement(\"li\",{key:index,className:classes},React.createElement(\"a\",{onClick:function onClick(){return _this2.getData(item-1);}},item));}),React.createElement(\"li\",{onClick:this.handleNext},React.createElement(\"a\",{\"aria-label\":\"Next\"},React.createElement(\"span\",{\"aria-hidden\":\"true\"},\"\\xBB\"))))),React.createElement(\"div\",{className:\"list-group\"},this.state.post.map(function(item,index){return React.createElement(\"a\",{className:\"list-group-item\",key:index},React.createElement(\"div\",{className:\"comment-avatar\"},React.createElement(Img,{src:\"/avatar/\"+item.username+'.jpg',alt:\"\"})),React.createElement(\"div\",{className:\"username\"},React.createElement(\"h4\",null,item.username),React.createElement(\"p\",null,item.datetime)),React.createElement(\"div\",{className:\"content\"},React.createElement(\"p\",null,item.content)));})));}}]);return PostList;}(React.Component);export default PostList;","map":{"version":3,"sources":["/Users/peiwendu/Desktop/shuoshuo2.0/client/src/components/PostList.js"],"names":["React","axios","Img","PostList","state","post","total","currentPage","getCount","get","then","res","setState","data","count","getData","page","fetch","method","headers","response","json","result","handlePrevious","console","log","handleNext","total_page","Math","ceil","pageNumber","i","push","map","item","index","classes","username","datetime","content","Component"],"mappings":"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","sourcesContent":["import React from 'react'\nimport axios from 'axios';\nimport './components.css';\nimport Img from './Img';\n\nclass PostList extends React.Component{\n\n    state = {\n        post: [],\n        total: 0,\n        currentPage: 1\n    }\n\n    getCount = () => {\n        axios.get('/count').then(res => {\n            this.setState({\n                total: res.data.count\n            })\n        })\n    }\n\n    getData = async (page) => {\n        const response = await fetch(`/allpost?page=${page}`, {\n            method: 'GET',\n            headers: {\n              'Accept': 'application/json',\n              'Content-Type': 'application/json',\n            },\n          });\n      \n          const data = await response.json();\n      \n          this.setState({\n            post: data.result,\n            currentPage: data.page + 1\n          });\n    }\n\n    componentDidMount(){\n        this.getCount();\n        this.getData(0); //0是后端的第一页\n    }\n\n    handlePrevious = () => {\n\n        if(this.state.currentPage !== 1){\n            this.getData(this.state.currentPage - 1 - 1);\n            console.log(\"previous\");\n        }\n    }\n\n    handleNext = () => {\n        var total_page = Math.ceil(this.state.total/5);\n        console.log(this.state.currentPage + 1 );\n        if(this.state.currentPage < total_page){\n            this.getData(this.state.currentPage);\n            console.log(\"next\");\n        }\n    }\n\n    render(){\n\n        const pageNumber = [];\n        if(this.state.total !== 0){\n            for(let i = 1; i <= Math.ceil(this.state.total/5); i++){\n                pageNumber.push(i);\n            }\n        }\n\n        return (\n            <div className=\"container\">\n               <nav aria-label=\"Page navigation\">\n                    <ul className=\"pagination\">\n                        <li onClick={this.handlePrevious}>\n                            <a aria-label=\"Previous\">\n                                <span aria-hidden=\"true\" >&laquo;</span>\n                            </a>\n                        </li>\n                            {\n                               pageNumber.map((item, index) => {\n                                let classes = (this.state.currentPage) === item ? \"active\" : '';\n                                        return <li key={index} className={classes}>\n                                                    <a \n                                                       onClick={() => this.getData(item - 1)}    \n                                                    >\n                                                       {item}\n                                                    </a>\n\n                                                </li>                         \n                               })\n                            }\n                        <li onClick={this.handleNext}>\n                            <a  aria-label=\"Next\" >\n                                <span aria-hidden=\"true\">&raquo;</span>\n                            </a>\n                        </li>\n                    </ul>\n                </nav>\n               <div className=\"list-group\">\n                    {\n                        this.state.post.map((item, index) => {\n                            return (\n                                 <a className=\"list-group-item\" key={index}>\n                                    <div className=\"comment-avatar\">\n                                           <Img src={\"/avatar/\" + item.username + '.jpg'} alt=\"\"/>\n                                    </div>\n                                    <div className=\"username\">\n                                        <h4>{item.username}</h4> \n                                        <p>{item.datetime}</p>\n                                    </div>\n                                    <div className=\"content\">\n                                        <p>{item.content}</p>\n                                    </div>\n                                   \n                                   \n                                </a>\n                            )\n                        })\n                    }\n                </div>\n            </div> \n            \n        )\n    }\n\n\n\n}\n\nexport default PostList"]},"metadata":{},"sourceType":"module"}