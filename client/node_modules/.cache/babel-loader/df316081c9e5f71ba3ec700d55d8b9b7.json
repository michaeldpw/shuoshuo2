{"ast":null,"code":"import _classCallCheck from\"/Users/peiwendu/Desktop/shuoshuo2.0/client/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/peiwendu/Desktop/shuoshuo2.0/client/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/Users/peiwendu/Desktop/shuoshuo2.0/client/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/Users/peiwendu/Desktop/shuoshuo2.0/client/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _inherits from\"/Users/peiwendu/Desktop/shuoshuo2.0/client/node_modules/@babel/runtime/helpers/esm/inherits\";import React from'react';import axios from'axios';import{NavLink}from'react-router-dom';import'./pages.css';import ReactCrop from'react-image-crop';import\"react-image-crop/dist/ReactCrop.css\";import{url}from'../url';import{extractImageFileExtensionFromBase64,image64toCanvasRef}from'../base64';axios.defaults.withCredentials=true;var imageMaxSize=1000000000;// bytes\nvar acceptedFileTypes='image/x-png, image/png, image/jpg, image/jpeg, image/gif';var acceptedFileTypesArray=acceptedFileTypes.split(\",\").map(function(item){return item.trim();});var SetAvatar=/*#__PURE__*/function(_React$Component){_inherits(SetAvatar,_React$Component);function SetAvatar(props){var _this;_classCallCheck(this,SetAvatar);_this=_possibleConstructorReturn(this,_getPrototypeOf(SetAvatar).call(this,props));_this.verifyFile=function(files){if(files&&files.length>0){var currentFile=files[0];var currentFileType=currentFile.type;var currentFileSize=currentFile.size;if(currentFileSize>imageMaxSize){alert(\"This file is not allowed. \"+currentFileSize+\" bytes is too large\");return false;}if(!acceptedFileTypesArray.includes(currentFileType)){alert(\"This file is not allowed. Only images are allowed.\");return false;}return true;}};_this.handleImageLoaded=function(image){//console.log(image)\n};_this.handleOnCropChange=function(crop){_this.setState({crop:crop});};_this.handleOnCropComplete=function(crop,pixelCrop){console.log(crop,pixelCrop);var canvasRef=_this.imagePreviewCanvasRef.current;var imgSrc=_this.state.imgSrc;image64toCanvasRef(canvasRef,imgSrc,crop);};_this.handleFileSelect=function(event){// console.log(event)\nvar files=event.target.files;console.log(files);if(files&&files.length>0){var isVerified=_this.verifyFile(files);if(isVerified){// imageBase64Data \nvar currentFile=files[0];var myFileItemReader=new FileReader();myFileItemReader.addEventListener(\"load\",function(){// console.log(myFileItemReader.result)\nvar myResult=myFileItemReader.result;_this.setState({imgSrc:myResult,imgSrcExt:extractImageFileExtensionFromBase64(myResult)});},false);myFileItemReader.readAsDataURL(currentFile);}}};_this.imagePreviewCanvasRef=React.createRef();_this.fileInputRef=React.createRef();_this.state={imgSrc:null,imgSrcExt:null,src:null,avatar:null,username:null,code:'',crop:{aspect:1/1},x:0,y:0,width:0,height:0};return _this;}_createClass(SetAvatar,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;axios.get(url+':'+port+'/getsession').then(function(res){_this2.setState({code:res.data.code,username:res.data.username,avatar:res.data.avatar});});}},{key:\"render\",value:function render(){var imgSrc=this.state.imgSrc;var url_username=this.props.match.params.username;return React.createElement(\"div\",{className:\"container avatar-container\"},this.state.username&&this.state.username==url_username?React.createElement(\"div\",null,React.createElement(\"form\",{method:\"post\",action:url+'+'+port+\"/uploadandcropavatar\",target:\"targetIfr\",encType:\"multipart/form-data\"},React.createElement(\"div\",{className:\"form-group\"},React.createElement(\"input\",{ref:this.fileInputRef,type:\"file\",name:\"image\",accept:acceptedFileTypes,multiple:false,onChange:this.handleFileSelect}),React.createElement(\"input\",{type:\"text\",readOnly:true,name:\"x\",value:this.state.crop.x}),React.createElement(\"input\",{type:\"text\",readOnly:true,name:\"y\",value:this.state.crop.y}),React.createElement(\"input\",{type:\"text\",readOnly:true,name:\"width\",value:this.state.crop.width}),React.createElement(\"input\",{type:\"text\",readOnly:true,name:\"height\",value:this.state.crop.height})),React.createElement(\"button\",{type:\"submit\",className:\"btn btn-default\"},\"Submit\"),React.createElement(\"iframe\",{name:\"targetIfr\",style:{display:\"none\"}})),React.createElement(\"br\",null),React.createElement(\"div\",null,React.createElement(ReactCrop,{src:imgSrc,crop:this.state.crop,onImageLoaded:this.handleImageLoaded,onComplete:this.handleOnCropComplete,onChange:this.handleOnCropChange}),React.createElement(\"br\",null),React.createElement(\"p\",null,\"Preview Canvas Crop \"),React.createElement(\"canvas\",{ref:this.imagePreviewCanvasRef}))):React.createElement(\"h1\",null,\"Sorry, you need to \",React.createElement(NavLink,{to:\"/signin\"},\"sign in\"),\".\"));}}]);return SetAvatar;}(React.Component);export default SetAvatar;","map":{"version":3,"sources":["/Users/peiwendu/Desktop/shuoshuo2.0/client/src/pages/SetAvatar.js"],"names":["React","axios","NavLink","ReactCrop","url","extractImageFileExtensionFromBase64","image64toCanvasRef","defaults","withCredentials","imageMaxSize","acceptedFileTypes","acceptedFileTypesArray","split","map","item","trim","SetAvatar","props","verifyFile","files","length","currentFile","currentFileType","type","currentFileSize","size","alert","includes","handleImageLoaded","image","handleOnCropChange","crop","setState","handleOnCropComplete","pixelCrop","console","log","canvasRef","imagePreviewCanvasRef","current","imgSrc","state","handleFileSelect","event","target","isVerified","myFileItemReader","FileReader","addEventListener","myResult","result","imgSrcExt","readAsDataURL","createRef","fileInputRef","src","avatar","username","code","aspect","x","y","width","height","get","port","then","res","data","url_username","match","params","display","Component"],"mappings":"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","sourcesContent":["import React from 'react';\nimport axios from 'axios';\nimport { NavLink } from 'react-router-dom';\nimport './pages.css';\nimport ReactCrop from 'react-image-crop';\nimport \"react-image-crop/dist/ReactCrop.css\";\nimport { url } from '../url'\n\nimport {extractImageFileExtensionFromBase64,\n\timage64toCanvasRef} from '../base64'\naxios.defaults.withCredentials = true;\n\nconst imageMaxSize = 1000000000 // bytes\nconst acceptedFileTypes = 'image/x-png, image/png, image/jpg, image/jpeg, image/gif'\nconst acceptedFileTypesArray = acceptedFileTypes.split(\",\").map((item) => {return item.trim()})\nclass SetAvatar extends React.Component{\n\n\t\tconstructor(props){\n\t\t\tsuper(props)\n\t\t\tthis.imagePreviewCanvasRef = React.createRef()\n\t\t\tthis.fileInputRef = React.createRef()\t\n\t\t\tthis.state = {\n\t\t\t\t\timgSrc: null,\n\t\t\t\t\timgSrcExt: null,\n\t\t\t\t\tsrc: null,\n\t\t\t\t\tavatar: null,\n\t\t\t\t\tusername: null,\n\t\t\t\t\tcode:'',\n\t\t\t\t\tcrop: {\n\t\t\t\t\t\taspect: 1 / 1,\n\t\t\t\t\t},\n\t\t\t\t\tx: 0,\n\t\t\t\t\ty: 0,\n\t\t\t\t\twidth: 0,\n\t\t\t\t\theight: 0\n\t\t}\n\t }\n\n\t verifyFile = (files) => {\n\t\tif (files && files.length > 0){\n\t\t\t\tconst currentFile = files[0]\n\t\t\t\tconst currentFileType = currentFile.type\n\t\t\t\tconst currentFileSize = currentFile.size\n\t\t\t\tif(currentFileSize > imageMaxSize) {\n\t\t\t\t\t\talert(\"This file is not allowed. \" + currentFileSize + \" bytes is too large\")\n\t\t\t\t\t\treturn false\n\t\t\t\t}\n\t\t\t\tif (!acceptedFileTypesArray.includes(currentFileType)){\n\t\t\t\t\t\talert(\"This file is not allowed. Only images are allowed.\")\n\t\t\t\t\t\treturn false\n\t\t\t\t}\n\t\t\t\treturn true\n\t\t}\n}\n\nhandleImageLoaded = (image) => {\n\t//console.log(image)\n}\nhandleOnCropChange = (crop) => {\n\tthis.setState({crop:crop})\n}\nhandleOnCropComplete = (crop, pixelCrop) =>{\n\tconsole.log(crop, pixelCrop)\n\tconst canvasRef = this.imagePreviewCanvasRef.current\n\tconst {imgSrc}  = this.state\n\timage64toCanvasRef(canvasRef, imgSrc, crop)\n}\n\nhandleFileSelect = event => {\n\t// console.log(event)\n\tconst files = event.target.files\n\tconsole.log(files);\n\tif (files && files.length > 0){\n\t\t\t\tconst isVerified = this.verifyFile(files)\n\t\t\t if (isVerified){\n\t\t\t\t\t // imageBase64Data \n\t\t\t\t\t const currentFile = files[0]\n\t\t\t\t\t const myFileItemReader = new FileReader()\n\t\t\t\t\t myFileItemReader.addEventListener(\"load\", ()=>{\n\t\t\t\t\t\t\t // console.log(myFileItemReader.result)\n\t\t\t\t\t\t\t const myResult = myFileItemReader.result\n\t\t\t\t\t\t\t this.setState({\n\t\t\t\t\t\t\t\t\t imgSrc: myResult,\n\t\t\t\t\t\t\t\t\t imgSrcExt: extractImageFileExtensionFromBase64(myResult)\n\t\t\t\t\t\t\t })\n\t\t\t\t\t }, false)\n\t\t\t\t\t myFileItemReader.readAsDataURL(currentFile)\n\t\t\t }\n\t}\n}\n\tcomponentDidMount(){ \n\t\taxios.get(url + ':' + port + '/getsession').then(res => {\n\t\t\tthis.setState({\n\t\t\t\tcode: res.data.code,\n\t\t\t\tusername: res.data.username,\n\t\t\t\tavatar: res.data.avatar\n\t\t\t})\n\t\t})\n\t}\n\n\trender(){\n\t\tconst {imgSrc} = this.state\n\t\tconst url_username = this.props.match.params.username;\n\t  \n\t\treturn (\n\t\t   \n\t\t\t<div className=\"container avatar-container\">\n\t\t\t\t{\n\t\t\t\t\tthis.state.username && this.state.username == url_username? \n\t\t\t\t\t<div>\n\t\t\t\t\t\t<form method=\"post\" \n\t\t\t\t\t\t\t\t\taction={url + '+' + port + \"/uploadandcropavatar\" }\n\t\t\t\t\t\t\t\t\ttarget=\"targetIfr\" \n\t\t\t\t\t\t\t\t\tencType=\"multipart/form-data\">\n\t\t\t\t\t\t\t<div className=\"form-group\">\n\t\t\t\t\t\t\t\t<input ref={this.fileInputRef} type='file' name=\"image\" accept={acceptedFileTypes} multiple={false} onChange={this.handleFileSelect} />\n\t\t\t\t\t\t\t  <input type=\"text\" readOnly name=\"x\" value={this.state.crop.x}/>\n\t\t\t\t\t\t\t\t<input type=\"text\" readOnly name=\"y\" value={this.state.crop.y}/>\n\t\t\t\t\t\t\t\t<input type=\"text\" readOnly name=\"width\" value={this.state.crop.width}/>\n\t\t\t\t\t\t\t\t<input type=\"text\" readOnly name=\"height\" value={this.state.crop.height}/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<button type=\"submit\" className=\"btn btn-default\" >Submit</button>\n\t\t\t\t\t\t  <iframe name=\"targetIfr\" style={{display:\"none\"}}></iframe> \n\t\t\t\t\t\t</form>\n\n        \t\t<br/>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t <ReactCrop\n                     src={imgSrc} \n                     crop={this.state.crop} \n                     onImageLoaded={this.handleImageLoaded}\n                     onComplete = {this.handleOnCropComplete}\n                     onChange={this.handleOnCropChange}/>\n\n                  <br/>\n                  <p>Preview Canvas Crop </p>\n                  <canvas ref={this.imagePreviewCanvasRef}></canvas>\n              </div>\n\t\t\t    </div>\n\t\t\t\t\t:<h1>Sorry, you need to <NavLink to=\"/signin\">sign in</NavLink>.</h1>\n\t\t\t\t}\n\t\t\t</div>\n\t\t)\n\t}\n}\n\nexport default SetAvatar;"]},"metadata":{},"sourceType":"module"}